# 目的express.js + mongodb做一个聊天服务demo
- 聊天服务api demo极其复杂,还有很多边界情况没有考虑
- 这里只做一个demo，不考虑性能问题，只考虑功能实现
## 分模块(todo)
- 用户登录注册模块
- (单人)聊天服务模块
- 用户注册登录完了之后把token和用户信息传递到chat server
- chat server来做聊天，单聊，群组等服务
- (群组/多人)聊天服务模块
- 考虑聊天用户数据还是来自共享的User Model
## 单人消息发送逻辑
- 发送者发送消息需要观察对方用户是否存在，否则发送消息失败，返回错误信息
- 发送者发送消息前需要先申请好友，好友只能申请一次，申请成功之后，发送者才能发送消息，对方接收到申请，需要同意或者拒绝
- 接收者收到好友申请后，同意之后更新到发送者的好友列表中，拒绝之后不做任何处理，发送者根据好友列表查询用户是否存在，存在则可以发送消息
- 获得历史消息只能是获得自己的历史消息，根据token获取自己的历史消息
- 消息撤回是根据消息id撤回消息，撤回消息之后，消息状态改为已撤回

## 用户注册登录逻辑(这里相对简单)
- 用户使用username和password注册，注册返回一个userid
- 登录返回一个token，这个token在以后的单人消息发送中使用

## 多人消息发送逻辑(这里相对复杂，还没调试)
- 用户创建群组需要带上自己的token，也就是登录状态，创建用户需要拉人，拉上已存在的用户才创建成功，否则不成功
- 一开始没在群组内的用户，需要申请进入群组，同意之后才能发送消息，或者由某个群员发送邀请进群，进群后才能发送群组消息
- 一个用户创建的群组需要唯一，不要重复命名，导致数据难以追踪(这可能是不够灵活的做法)
- 一个人发送消息之后，所有群员都要接收消息，所有群员都要保存消息(这里是消息推送)
- 还要获得某个群组的历史消息，不单单是群主能发消息，群员也能发消息



### 我得考虑别人是怎么做聊天服务的，这太难了，太难debug了，根本不可扩展，不可追踪bug
- 调试步骤
1. 先注册用户
2. 登录用户
3. 添加好友
4. 接受好友
---
1. 添加群组
2. 发送群组消息
3. 查看消息